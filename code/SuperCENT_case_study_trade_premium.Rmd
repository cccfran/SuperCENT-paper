---
title: "Global trade network and currency risk premium"
author: "Junhui Cai, Dan Yang, Wu Zhu, Haipeng Shen, Linda Zhao"
output:
  pdf_document:
    number_sections: yes
  html_document:
    df_print: paged
    highlight: haddock
    number_sections: yes
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
editor_options: 
  chunk_output_type: console
urlcolor: blue
---

```{r setup, include=FALSE}
if (!require("pacman")) install.packages("pacman")
pacman::p_load(data.table, matrixStats, dplyr, ggplot2, igraph,
               latex2exp, tidyverse,
               irlba, xtable, stargazer, circlize, kableExtra)

# source("utils_sim.R")
# source("utilities.R")
# Rcpp::sourceCpp("utilities.cpp")

if(!require("SuperCENT")) devtools::install_github("cccfran/SuperCENT")

sim_setup <- NULL
fig_height <- 6
fig_width <- 8

knitr::opts_chunk$set(echo = F, fig.height = fig_height, fig.width = fig_width)
output_type <- knitr::opts_knit$get("rmarkdown.pandoc.to")
if(is.null(output_type)) output_type <- "latex"

max_iter <- 1000
```

This file is produced by `SuperCENT_case_study_trade_premium.Rmd` which contains both codes to reproduce the results in "Network Regression and Supervised Centrality Estimation" and the descriptions and instructions of the code chunks.
To reproduce this report, `Knit` this file in RStudio.
One can set `echo = T` for the each chunk or globally `knitr::opts_chunk$set(echo = T)` to show the code in the report.

# Data

We first read the data. The data is constructed using the following scripts.

* `real_gdp_long.csv`: GDP data generated using `construct_gdp_data.R`.
* `FX.csv`: risk premium constructed based on Richmond, R. J. (2019). "Trade network centrality and currency risk premia." *The Journal of Finance*, 74(3), 1315-1361. See instructions [here](https://onlinelibrary.wiley.com/action/downloadSupplement?doi=10.1111%2Fjofi.12755&file=jofi12755-sup-0001-ReplicationCode.zip).
* `trade_data_sub.csv`: bilateral trade data generated by `construct_trade_data.R`.

```{r}
# fx
fx_raw <- fread("../data_trade_premium/FX.csv")
setnames(fx_raw,
         old = c("iso3"),
         new = c("code"))

fx_raw[, year := year(Date)]
fx_raw[, rx := exp(logrx)]
fx_raw_year <- fx_raw[, lapply(.SD, mean, na.rm=T), 
                      by = .(code, year), 
                      .SDcols = c("rx")]
fx_raw_year[, logrx := log(rx)]

# gdp 
if(!file.exists("../data_trade_premium/real_gdp_long.csv")) source("construct_gdp_data.R")
gdp_raw <- fread("../data_trade_premium/real_gdp_long.csv")

# trade
if(!file.exists("../data_trade_premium/trade_data_sub.csv")) source("construct_trade_data.R")
trade_raw <- fread("../data_trade_premium/trade_data_sub.csv")
```

# Risk primium 

The following chunk produces Figure 11.
The figure shows the time series plot of the rank of the 5-year moving average of risk premium from 2003 to 2012 for the 24 countries/regions. 
In each year, we rank the 24 countries/regions from 1 to 24
from the largest risk premium to the smallest, i.e., in descending order of the risk premium.

```{r}
rx_df <- NULL
gap <- 5
for(yy in 1999:(2012 - gap + 1)) {
  # print(yy)
  ymax <- min(yy+gap-1, 2014)
  years <- yy:ymax
  
  # prepare trade and rx
  trade <- trade_raw[year %in% years][, .(value = mean(value,na.rm = T)),
                                      by=.(from, to)]
  
  vars <- c("rx")
  
  risk_premium <- fx_raw_year
  premium <- fx_raw_year[year %in% years][, lapply(.SD, mean, na.rm=T), 
                                          by=.(code),.SDcols = vars]
  premium[, logrx := log(rx)]
  
  
  gdp <- gdp_raw[year %in% years][, .(gdp = mean(gdp)), by = .(code)]
  premium <- merge(premium, gdp, by = "code", all.x = T)
  
  # construct trade table
  premium_exist <- premium[!is.na(logrx) & code %in% unique(trade$from) & !is.infinite(logrx),]
  
  # main
  premium_exist[, rank := rank(-logrx)]
  rx_df <- rbind(rx_df,
                 premium_exist[,.(code, logrx, rank, year = yy, gap = gap)])
}

rx_df %>% ggplot(aes(x = year + gap - 1, y = rank)) + 
  geom_line() +
  geom_vline(xintercept = 2008, linetype = "longdash") +
 facet_wrap(~code) +
  xlab("Year") +
  ylab("Rank of risk premium") + 
  scale_x_continuous(breaks = (1999:2008)+gap-1 )+
  theme_bw() +
  theme(text = element_text(size = 13),
    legend.position = "bottom", 
        legend.title = element_blank(),
        axis.text.x = element_text(angle = -90, vjust = 1))

ggsave(paste0("../output_trade_premium/plot/risk_premium_trend_", gap, ".pdf"),
       width = 8, height = 6)
```

# 2003 - 2012

We first run the two-stage and SuperCENT with 10-fold cross-validation on 1999-2008 with a window of 5.
Specifically, when considering 
year $t$, all the relevant quantities are the averages from year $t-4$ to year $t$. 

Following Richmond (2019) we define the trade linkage as the trade amount normalized by the pair-wise total GDP, which represents the relative trade (export/import) intensity between two countries. Specifically, the trade linkage between two countries is computed as
$$
{a_{ijt}}
= \frac{S_{ijt}}{GDP_{it} + GDP_{jt} },
$$
where $S_{ijt}$ is the dollar value of goods and commodities exported from country $i$ to country $j$ at time $t$, and $GDP_{it}$ is the GDP of country $i$ at time $t$ in U.S. dollar. 
We define $\text{GDP share}$ as the percentage of country/region GDP among the world GDP, where the world GDP is the total GDP of all available countries in the sample for that year. The model are, for each $t$,
\begin{eqnarray}
{a_{ijt}}
&=& d~\text{Hub}_{it} \times \text{Authority}_{jt} + e_{ijt},\\
\text{rx}_{it} &=& \alpha + {\beta_{ut}} \cdot \text{Hub}_{it} + {\beta_{vt}} \cdot \text{Authority}_{it} + {\beta_{xt}} \cdot \text{GDP share}_{it} + \epsilon_{it}.
\end{eqnarray}

```{r}
gap <- 5
ymax <- 2012-gap+1
years <- seq(1999, ymax, 1)

for(yy in years) {
  filepath <- paste0("../output_trade_premium/",
                     yy, "_gap", gap, "_miter", max_iter, ".RDS")
  if(!file.exists(filepath)) {
    system(paste("Rscript trade_premium_main.R", gap, max_iter))
  }  
}
```

## Centrality trend: Figures 12-13

The following chunk produce Figure 12-13.
Figure 12 shows the time series plots of the ranking of the hub centrality estimated by two-stage and SuperCENT for the 24 countries/regions, together with the ranking of the currency risk premium. 
Figure 13 is for the authority centrality.
We rank the centrality in ascending order and the risk premium in descending order. 


```{r}
gap <- gapp <- 5
ymax <- 2012-gap+1
years <- seq(1999, ymax, 1)
setting <- "gdp"

annual_df <- NULL
for(yy in years) {
  
  # read results RDS
  filepath <- paste0("../output_trade_premium/",
                     yy, "_gap", gap, "_miter", max_iter, ".RDS")
  
  ret_rds <- readRDS(filepath)
  ret <- ret_rds$ret
  ret_lr <- ret_rds$ret_lr
  ret_cv <- ret_rds$ret_cv
  
  # get the rank of two-stage
  ret_rank <- ret$cent
  ret_rank[, method := "Two-stage"]
  ret_rank[, rank_u := rank(u)]
  ret_rank[, rank_v := rank(v)]
  
  # get the rank of SuperCENT CV
  ret_cv_rank <- ret_cv$cent
  ret_cv_rank[, method := "SuperCENT CV"]
  ret_cv_rank[, rank_u := rank(u)]
  ret_cv_rank[, rank_v := rank(v)]
  
  ret_df <- rbindlist(list(ret_rank, 
                           # ret_lr_rank, 
                           ret_cv_rank))
  ret_df[, year := (yy)]
  
  annual_df <- rbindlist(list(annual_df, ret_df))
}

# merge with risk premium
annual_df <- rbindlist(list(annual_df,
                            rx_df[gap == gapp & year <= ymax][, method :=  "Risk premium"]), fill = T)
annual_df[is.na(rank_u), rank_u := rank]
annual_df[is.na(rank_v), rank_v := rank]

# change year label
annual_df[, year := year + gapp - 1]
annual_df[, year := as.character(year)]

hue_cols <- scales::hue_pal()(2)
method_colors <- c("Risk premium" = "black",
                   "SuperCENT CV" = hue_cols[2],
                   "Two-stage" = hue_cols[1]) 
# labels <- unname(TeX(c("Risk premium", "SuperCENT-$\\widehat{\\lambda}_{cv}$ Hub", "Two-stage Hub") ))
labels <- unname(TeX(c("Risk premium", "SuperCENT Hub", "Two-stage Hub") ))


# annual_df[code %in% sel_countries] %>% 
annual_df %>% 
  ggplot(aes(x = year , y = rank_u, 
             col = method, group = method,
             linetype = method)) +
  geom_line(size = 1) +
  geom_vline(xintercept = "2008", linetype = "longdash") +
  facet_wrap(~code) +
  ylab("Rank") + 
  scale_color_manual(values = method_colors,
                     labels = labels) +
  scale_linetype_manual(values=c(11, "solid", "dashed"),
                        labels = labels) +
  theme_bw() +
  theme(text = element_text(size = 13),
        legend.position = "bottom", 
        legend.title = element_blank(),
        axis.text.x = element_text(angle = -90, vjust = 1),
        legend.text = element_text(size = 13),
        legend.margin = margin(t=-10),
        legend.key.size = unit(1, "cm")) 
ggsave(paste0("../output_trade_premium/plot/hub_gap", gapp,  ".pdf"),
       width = 8, height = 6)

# labels <- unname(TeX(c("Risk premium", "SuperCENT-$\\widehat{\\lambda}_{cv}$ Authority", "Two-stage Authority") ))
labels <- unname(TeX(c("Risk premium", "SuperCENT Authority", "Two-stage Authority") ))
# annual_df[code %in% sel_countries] %>% 
annual_df %>% 
  ggplot(aes(x = year , y = rank_v, 
             col = method, group = method,
             linetype = method)) +
  geom_line(size = 1) +
  geom_vline(xintercept = "2008", linetype = "longdash") +
  facet_wrap(~code) +
  ylab("Rank") + 
 scale_color_manual(values=method_colors,
                     labels = labels) +
  scale_linetype_manual(values=c(11, "solid", "dashed"),
                        labels = labels) +
  theme_bw() +
  theme(text = element_text(size = 13),
        legend.position = "bottom", 
        legend.title = element_blank(),
        axis.text.x = element_text(angle = -90, vjust = 1),
        legend.text = element_text(size = 13),
        legend.margin = margin(t=-10),
        legend.key.size = unit(1, "cm")) 
ggsave(paste0("../output_trade_premium/plot/authority_gap", gapp, ".pdf"),
       width = 8, height = 6)

```

## Long-short strategy

### Figure 14

We examine a long-short strategy based on the centrality estimated by SuperCENT-CV and two-stage
based on theory that a country with low centrality exhibits a higher expected currency premium 
than the ones with high centralities.
The following chunk produces Figure 14 which 
shows the year $t+1$ return based on this strategy.

```{r}
gap <- 5
ymax <- 2012-gap+1
years <- seq(1999, ymax, 1)
topns <- 3:5
annual_df_list <- NULL

hue_cols <- scales::hue_pal()(2)
method_colors <- c("SuperCENT CV" = hue_cols[2],
                   "Two-stage" = hue_cols[1]) 
# labels <- unname(TeX(c("SuperCENT-$\\widehat{\\lambda}_{cv}$", "Two-stage") ))
labels <- unname(TeX(c("SuperCENT$", "Two-stage") ))

for(topn in topns) {
  annual_df <- NULL
  for(yy in years) {
    
    # read results RDS
    filepath <- paste0("../output_trade_premium/",
                     yy, "_gap", gap, "_miter", max_iter, ".RDS")
    
    ret_rds <- readRDS(filepath)
    ret <- ret_rds$ret
    ret_cv <- ret_rds$ret_cv
    
    # get the risk premium of the next period
    ret_next <- fread("../data_trade_premium/FX.csv")
    setnames(ret_next, old="iso3", new="code")
    ret_next[, year:=year(Date)]
    ret_next <- ret_next[year == yy+gap+1]
    ret_next[, rx := exp(logrx)]
    ret_next <- ret_next[, lapply(.SD, mean, na.rm=T), 
                      by = .(code, year), 
                      .SDcols = c("rx")]
    ret_next[, logrx := log(rx)]
    
    # get the centrality ranking of two-stage and SuperCENT CV 
    # based on the period of t-4 and t
    ## get the two-stage ranking
    ret_rank <- ret$cent
    ret_rank[, method := "Two-stage"]
    ret_rank[, rank_u := rank(u)]
    ret_rank[, rank_v := rank(v)]
    ret_rank <- merge(ret_rank,
                      ret_next[, .(code, logrx)], by = "code")
    
    ## get SuperCENT CV ranking 
    ret_cv_rank <- ret_cv$cent
    ret_cv_rank[, method := "SuperCENT CV"]
    ret_cv_rank[, rank_u := rank(u)]
    ret_cv_rank[, rank_v := rank(v)]
    ret_cv_rank <- merge(ret_cv_rank,
                         ret_next[, .(code, logrx)], by = "code")
    
    ret_df <- rbindlist(list(ret_rank, 
                             ret_cv_rank))
    ret_df[, rx := exp(logrx)]
    
    # rank by u 
    setorder(ret_df, method, u)
    btm <- ret_df[,head(.SD, topn), by = "method"][, .(mean_rx_btm = mean(rx)), by = "method"]
    top <- ret_df[,tail(.SD, topn), by = "method"][, .(mean_rx_top = mean(rx)), by = "method"]
    hub_return <- merge(top, btm, by = "method")
    hub_return[, excess_return := mean_rx_btm - mean_rx_top]
    hub_return[, cent := "Hub"]
    
    # rank by v
    setorder(ret_df, method, v)
    btm <- ret_df[,head(.SD, topn), by = "method"][, .(mean_rx_btm = mean(rx)), by = "method"]
    top <- ret_df[,tail(.SD, topn), by = "method"][, .(mean_rx_top = mean(rx)), by = "method"]
    aut_return <- merge(top, btm, by = "method")
    aut_return[, excess_return := mean_rx_btm - mean_rx_top]
    aut_return[, cent:= "Authority"]
    
    ret_df <- rbind(hub_return, aut_return)
    ret_df[, year := as.character(yy)]
    
    annual_df <- rbindlist(list(annual_df, ret_df))
  }
  
  annual_df[, top := topn]
  annual_df[, cent := factor(cent, levels = c("Hub", "Authority"))]
  annual_df %>% 
    ggplot(aes(x = as.character(as.numeric(year) + gap), y = excess_return, 
               col = method, group = method,
               linetype = method)) +
    geom_line(size = 1) +
    facet_wrap(~cent) +
    xlab("Year") +
    ylab("Return") + 
  scale_color_manual(values = method_colors,
                     labels = labels) +
  scale_linetype_manual(values=c("solid", "dashed"),
                        labels = labels) +
    theme_bw() +
    theme(text = element_text(size = 13),
        legend.position = "bottom", 
        legend.title = element_blank(),
        axis.text.x = element_text(angle = -90, vjust = 1),
        legend.text = element_text(size = 13),
        legend.margin = margin(t=-10),
        legend.key.size = unit(1, "cm")) 
  ggsave(paste0("../output_trade_premium/plot/excess_return_next_gap", gap, "_top", topn, ".pdf"),
       width = 8, height = 4)
  
  annual_df_list <- rbindlist(list(annual_df_list, annual_df))
}
```

### Table II

The following chunk produces Table II, the 10-year average return based on this strategy 
with the top and bottom 3, 4, and 5 currencies, respectively.

```{r}
options(scipen=999)
excess_return_diff <- annual_df_list[, mean(excess_return), by = c("cent", "method", "top")]
excess_return_diff$cent <- factor(excess_return_diff$cent, levels = c("Hub", "Authority"))
diff_tbl <- dcast(excess_return_diff, top+cent~method, value.var = "V1")
diff_tbl[, "Relative difference" := scales::percent((`SuperCENT CV` - `Two-stage`)/abs(`Two-stage`))]
cols_tmp <- c("SuperCENT CV", "Two-stage")
diff_tbl[, (cols_tmp) := lapply(round(.SD, 4), as.character), .SDcols = cols_tmp]
diff_tbl <- melt(diff_tbl, id.vars = c("top", "cent"))
diff_tbl <- dcast(diff_tbl, variable~top+cent, value.var = "value")
names(diff_tbl) <- sapply(strsplit(names(diff_tbl), "_"), tail, 1)
names(diff_tbl)[1] <- ""

ls_return <- kbl(diff_tbl,
    booktabs = T,
    digits=  4,
    format = "latex",
    caption = "The 10-year average return",
    label = paste0("tbl:excess-return-", gap)) %>%
  add_header_above(data.frame(header = c("", paste0("Top/Bottom ", topns) ),
           colspan = c(1, rep(2, length(topns))))
  ) 
ls_return

ls_return %>%
  save_kable(paste0("../output_trade_premium/10_year_return_gap", gap, ".tex"))

```



# 10-year

We run the two-stage and SuperCENT with 10-fold cross-validation on 1999 with a window of 10, i.e., 1999-2008.
Specifically, we take the 10-year average of trade volume and GDP to construct a 10-year trade network
and GDP share. Similarly, we take the 10-year average of risk premium as the response.

```{r}
gap <- 10

filepath <- paste0("../output_trade_premium/1999_gap", gap, "_miter", max_iter, ".RDS")
if(!file.exists(filepath)) {
  system(paste("Rscript trade_premium_main.R", gap, max_iter))
}
```

## Table III
```{r, results='asis'}
filepath <- paste0("../output_trade_premium/1999_gap", gap, "_miter", max_iter, ".RDS")

# read RDS results
ret_rds <- readRDS(filepath)
ret <- ret_rds$ret
ret_lr <- ret_rds$ret_lr
ret_cv <- ret_rds$ret_cv
ret$epsy <- epsy_hat(ret)
ret_cv$epsy <- epsy_hat(ret_cv)

# set up for stargazer
## cov labels
cov.labels <- c("GDP share", "Hub", "Authority")
## dep label
dep.labels <- "Risk premium"
## notes 
notes <- ifelse(gap == 1, paste0("Year ", yy),
                paste0("Year ", yy, "-", ymax))
## lm results
df_cols <- c("y", "X", "u", "v")
ret_formula <- as.formula(y~X+u+v)
tmp <- data.table(y = ret$y, X = ret$X[,colnames(ret$X) != "(Intercept)"],
                  u = ret$u, v = ret$v)
names(tmp) <- df_cols
lm_two_stage <- lm(ret_formula, tmp)

tmp <- data.table(y = ret_lr$y,X = ret_lr$X[,colnames(ret$X) != "(Intercept)"],
                  u = ret_lr$u, v = ret_lr$v)
names(tmp) <- df_cols
lm_supercent_approx <- lm(ret_formula, tmp)

tmp <- data.table(y = ret_cv$y, X = ret_cv$X[,colnames(ret$X) != "(Intercept)"],
                  u = ret_cv$u, v = ret_cv$v)
names(tmp) <- df_cols
lm_supercent_cv <- lm(ret_formula, tmp)

stargazer(lm_two_stage,
          lm_two_stage, 
          lm_supercent_cv, 
          keep = c("X", "u", "v"), 
          column.labels = c("Two-stage-naive", "Two-stage", "SuperCENT CV"), 
          coef = list(NULL, NULL, ret_cv$beta),
          se = list(NULL, confint(ret)$sds, confint(ret_cv)$sds),
          p = list(NULL, confint(ret)$p, confint(ret_cv)$p),
          dep.var.labels = dep.labels,
          covariate.labels = cov.labels,
          omit.stat=c("f", "ser", "adj.rsq", "rsq"),
          star.char = c("*", "**", "***"),
          star.cutoffs = c(.1, .05, .01),
          type = "latex",
          notes = notes,
          digits = 4,
          out = paste0("../output_trade_premium/trade_premium_", yy,
                       "_gap", gap, "_miter", max_iter, ".tex")
)
```

The following chunk calculates the miscellaneous values.

```{r, eval = F}
nn <- length(ret$u)
epsay <- data.table(method = c("Two-stage-naive", "Two-stage", "SuperCENT CV"), 
                    sigmay = c(summary(lm_two_stage)$sigma, 
                               ret$epsy, ret_cv$epsy),
                    sigmaa = c(ret$epsa, ret$epsa, ret_cv$epsa),
                    d = c(ret$d, ret$d, ret_cv$d),
                    kappa = log2(c(ret$epsa^2/ret$d^2/nn, 
                                   ret$epsa^2/ret$d^2/nn, 
                                   ret_cv$epsa^2/ret_cv$d^2/nn)),
                    u = (abs(c(ret$beta[3]^2/summary(lm_two_stage)$sigma^2,
                               ret$beta[3]^2/ret$epsy^2, 
                               ret_cv$beta[3]^2/ret_cv$epsy^2))),
                    v = (abs(c(ret$beta[4]^2/summary(lm_two_stage)$sigma^2,
                               ret$beta[4]^2/ret$epsy^2, 
                               ret_cv$beta[4]^2/ret_cv$epsy^2))),
                    u_snr = log2(abs(c(ret$beta[3]^2/summary(lm_two_stage)$sigma^2,
                                       ret$beta[3]^2/ret$epsy^2, 
                                       ret_cv$beta[3]^2/ret_cv$epsy^2))),
                    v_snr = log2(abs(c(ret$beta[4]^2/summary(lm_two_stage)$sigma^2,
                                       ret$beta[4]^2/ret$epsy^2, 
                                       ret_cv$beta[4]^2/ret_cv$epsy^2)))
)
rho <- cor(ret_cv$u, ret_cv$v)
kappa <- ret_cv$epsa^2/ret_cv$d^2/nn
rho/(1+kappa)*ret_cv$beta[4]
-kappa * ((1+kappa)*ret_cv$beta[3] - rho*ret_cv$beta[4])
-kappa * ((1+kappa)*ret_cv$beta[4] - rho*ret_cv$beta[3])

kableExtra::kbl(epsay, booktabs = T,
                format = "latex",
) %>%
  save_kable(paste0("../output_trade_premium/trade_premium_epsy_", yy,
                    "_gap", gap, "_miter", max_iter, ".tex"))
```


# Supplement

## Table SI: Country code 

The following chunk produces Table SI which provides the country acronyms and full names.

```{r}
gdp_data <- fread("../data_trade_premium/real_gdp_long.csv")
country_list <- unique(gdp_data[,.(country, code)])
country_list[grep("United States", country), country := "United States"]
country_list[grep("KOR", code), country := "South Korea"]

codes <- data.frame(code = ret$cent$code)
codes <- dplyr::inner_join(codes, country_list, by = "code")
codes$country <- stringr::str_to_title(codes$country)
kableExtra::kbl(codes, format = "latex", booktabs = T, centering  = T)
```

## Figure S21 Trade circular plot: 1999 - 2008

The following figure shows the average trade volume from 2003 to 2012 among the 24 countries/regions. The arrows reflect the trade directions and the widths represent the volume.

```{r, message=FALSE, warning=FALSE}
years <- 1999:2008
# prepare trade
trade_df <- trade_raw[year %in% years, 
                      .(total = sum(value, na.rm=T)), by = c("from", "to")]
# gdp
# gdp <- gdp_raw[year %in% years][, .(gdp = mean(gdp)), by = .(code)]
# merge with premium
vars <- c("rx")
premium <- fx_raw_year[year %in% years][, lapply(.SD, mean, na.rm=T), 
                                          by=.(code),.SDcols = vars]
# premium <- merge(premium, gdp, by = "code", all.x = T)
premium_exist <- premium[!is.na(rx) & code %in% unique(trade$from),]
setorderv(premium_exist, "code")
trade_sub <- merge(premium_exist[, .(to = code)], 
                   trade_df, by = "to")
trade_sub <- merge(premium_exist[, .(from = code)], 
                   trade_sub, by = "from")

# graph and mat
graph <- graph_from_data_frame(trade_sub[,.(from, to, weight = total)], directed = T)
mat <- as_adjacency_matrix(graph, attr = "weight", sparse = F)

# circular plot
grid.col <- setNames(rainbow(length(colnames(mat))),  colnames(mat))
chordDiagram(mat, 
               grid.col = grid.col,
               self.link =  1,
               directional = 1, direction.type = c("diffHeight", "arrows"),
               link.arr.type = "big.arrow", diffHeight = -uh(2, "mm"))

pdf("../output_trade_premium/plot/circular.pdf", width = 6, height = 6) 
chordDiagram(mat, 
               grid.col = grid.col,
               self.link =  1,
               directional = 1, direction.type = c("diffHeight", "arrows"),
               link.arr.type = "big.arrow", diffHeight = -uh(2, "mm"))
dev.off()
```
